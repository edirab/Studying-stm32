# Изучаем DHT

[Исходники проекта](https://github.com/quen0n/DHT11-DHT22-STM32-HAL)

![](./dht11_protocol.jpg)

```text
Сперва удерживаем порядка 20 мс низкий уровень шины, потом отпускаем ее, 
через 20 мс датчик зажимает ее в 0 сам и держит 80 мкс потом отпускает на 80 мкс 
(формирует сигнал присутствия) за ним следует 40 бит данных, 
с одинаковым стартом — зажатием шины на 50 мкс и битом. 
бит 0 где-то 28 мкс, бит 1 — 70 мкс. 
Ну и на прощание датчик зажимает и отпускает шину. 
40 бит данных это 5 байт из которых первых два влажность, следующие 2 температура и байт четности. 
Байт четности равен сумме предыдущих байт. 1-й байт и 3-й байты передают значения, 
2 и 4 я так понял зарезервированы под десятые доли.
```

Библиотека для работы с датчиками DHT11/DHT22/AM2302/AM2301 на STM32. Для управления портами ввода/вывода используется HAL. Имеется возможность переделки под CMSIS, SPL или под другие микроконтроллеры. 
### Использование 
1) Настройте ваш проект в CubeMX. Настройте необходимый порт ввода/вывода в любом направлении (на ввод или вывод, не важно). Сгенерируйте проект.
2) Скопируйте ```DHT.h``` и ```DHT.c``` в папки проекта ```Inc``` и ```Src``` соответственно. При необходимости подключите файлы в IDE. 
3) В ```DHT.h``` укажите используемый порт, а так же при необходимости включите подтяжку линии данных.
4) Подключите ```DHT.h``` в нужном файле и для получения данных с датчика вызовите ```DHT_getData()``` указав в аругменте тип датчика - DHT11 или DHT22.
### Пример кода 
```c
#include "DHT.h"
#include <stdio.h>

int main(void) {
  while(1) {
    DHT_data d = DHT_getData(DHT22);
    printf("Temp: %2.1f*С, Hum: %2.1f%%\r\n", d.temp, d.hum);
    HAL_Delay(1000);
   }
}
```
![Температура и влажность в комнате](https://sun9-55.userapi.com/c855020/v855020053/1c8858/-fYv_Iowm7M.jpg)

### Переделка под другие библиотеки/платформы
Для переделки под, например, AVR, в ```DHT.c``` переделайте значения макроподстановок ```lineDown()```, ```lineUp()```, ```getLine()```, ```Delay()```  и функции ```goToOutput()```, ```goToInput()```.
### Обратная связь, нужна помощь?
Предложения или найденные баги можно сообщить в Telegram http://t.me/rainbowkiwifox, ВКонтакте https://vk.com/rainbowkiwifox или на почту rainbowkiwifox@gmail.com
